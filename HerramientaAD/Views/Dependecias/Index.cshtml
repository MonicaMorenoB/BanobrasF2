@model HerramientaAD.Models.DependeciasModel

    @{
        ViewBag.Title = "Dependecias";
        Layout = "~/Views/Shared/_Layout.cshtml";
    }

    <!DOCTYPE html>
    <html>
    <head>
       
    </head>
    <body>

        <div class="jumbotron">
            <h1 class="display-3">Dependencias</h1>
            <p class="lead">ABC</p>
            <hr class="my-4">
        </div>

        <form>
            <fieldset>
                <legend>Filtros</legend>
                <table align="center">
                    <tr style="height: 50px">
                        <td width="370px" align="center">

                            <button type="button" class="btn btn-primary" style="width:300px" id="btnFiltrosBD">Objetos de Base de Datos</button>
                        </td>
                        <td width="370px" align="center">
                            <button type="button" class="btn btn-primary" style="width:300px" id="btnFiltrosWS">Objetos de Interfases y Servicios</button>
                        </td>
                        <td width="370px" align="center">
                            <button type="button" class="btn btn-primary" style="width:300px" id="btnFiltrosCM">Objetos de Clases y Métodos</button>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="form-group">
                                @Html.LabelFor(m => m.AreaID, "Area:")
                                @Html.DropDownListFor(m => m.AreasLista, new SelectList(Model.AreasLista, "Indice", "Texto"), "Selecciona", new { @class = "form-control" })
                            </div>
                        </td>
                        <td>
                            <div class="form-group">
                                @Html.LabelFor(m => m.AplicacionID, "Aplicación:")
                                @Html.DropDownListFor(m => m.AplicacionesLista, new SelectList(Model.AplicacionesLista, "Indice", "Texto"), "Selecciona", new { @class = "form-control" })
                            </div>
                        </td>

                    </tr>
                    <tr style="height: 50px">
                        <td width="370px" align="center">
                            <button type="button" class="btn btn-primary" style="width:300px" id="btnBuscar">Buscar</button>
                        </td>
                    </tr>


                    <tr style="height: 50px">
                    </tr>
                </table>
            </fieldset>
        </form>

        <div id="HGrid">
            <br />
            <br />
            <table cellspacing="0" id="Tabla0" style="width: 100%; border-collapse: collapse; color: #fff; ">
                <tr class="GridViewScrollHeader">
                    <th class="CampoMasCorto">USO</th>
                    <th class="CampoAnalisis">Objeto -> Dependencias</th>
                    <th class="CampoDescarga">Tipo de objeto</th>
                </tr>
            </table>
        </div>



        <table>
            <tr>
                <th>
                    <div id="divdet">
                        @{
                            Html.RenderPartial("Detalle");
                        }
                    </div>
                </th>
                <th style="width: 50px;"></th>
                <th style="text-align: center;">
                    <h1>INDICADORES</h1>
                    <label for="checking" , id="lblIndi1" class="lblDetalle"></label><br />
                    <label for="checking" , id="lblIndi2" class="lblDetalle"></label><br />
                    <label for="checking" , id="lblIndi3" class="lblDetalle"></label><br />
                    <label for="checking" , id="lblIndi4" class="lblDetalle"></label><br />
                    <label for="checking" , id="lblIndi5" class="lblDetalle"></label><br />
                    <label for="checking" , id="lblIndi6" class="lblDetalle"></label>
                </th>
            </tr>
        </table>
        <br />
        <br />
        <h1 style="text-align: center;">DIAGRAMA</h1>
        <div id="divdet2" style="width:100%;">
            @{
                Html.RenderPartial("Diagrama");
            }
        </div>


    </body>
</html>


    <script src="~/Scripts/jquery-3.3.1.js"></script>
<script>

   

        var tpfil = "BD";
    var tipo =0;

    function limpiarfiltros() {
        $("#AreasLista").empty;
        $("#AreasLista")[0].selectedIndex = 0;
        $("#AplicacionesLista").empty;
        $("#AplicacionesLista")[0].selectedIndex = 0;
    }

    $(document).ready(function () {

        $("#AreasLista").change(function () {
            var a = $("#AreasLista Option:Selected").val();
            var url = '@Url.Content("~/")' + "Dependecias/ActualizarAplicaciones";
            var ddlsource = "#AreasLista Option:Selected";
            $.getJSON(url, { areaid: $(ddlsource).val() }, function (data) {
                var items = '';
                $("#AplicacionesLista").empty;
                $.each(data, function (i, row) {
                    items += "<option value='" + row.Value + "'>" + row.Text + "</option>";
                });
                $("#AplicacionesLista").html(items);
            }).fail(function (jqxhr, textStatus, error) {
                var err = textStatus + ", " + error;
                console.log("Request Failed: " + err);
            });
        });

     

        $('#btnFiltrosBD').click(function () {
            tpfil = "BD";
            tipo = 1;
            limpiarfiltros();
        });

        $('#btnFiltrosWS').click(function () {
            tpfil = "WS";
            tipo = 3;
            limpiarfiltros();
        });

        $('#btnFiltrosCM').click(function () {
            tpfil = "CM";
            tipo = 2;
            limpiarfiltros();
        });

        $('#btnBuscar').click(function () {
            var idapp = $("#AplicacionesLista Option:Selected").val();
            if (tpfil == "BD") {
                var fil1 = $("#AplicacionesLista Option:Selected").val();
            }

            if (tpfil == "WS") {
                var fil1 = $("#AplicacionesLista Option:Selected").val();
            }

            if (tpfil == "CM") {
               var fil1 = $("#AplicacionesLista Option:Selected").val();
            }
            CargaIndicadores(tipo,fil1,0)
            ActualizaDetalle(fil1)
        });
    });


     

    function ActualizaDetalle(_AplicacionID) {
            $.ajax({
                type: "POST",
                url: "/Dependecias/ActualizarConsulta",
                data: { AplicacionID: _AplicacionID},
                success: function (viewHTML) {
                          $("#divdet").empty;
                $("#divdet").html(viewHTML);     
                },
                error: function (errorData) { console.log("Request Failed: " + errorData); }
            });
    }

    function CargaIndicadores(_TipoID, _AplicacionID, _ProcesoID) {

        $.ajax({
            async: false,
            type: "GET",
            url: "/Dependecias/ActualizaIndicadores",
            data: { TipoID: _TipoID, AplicacionID: _AplicacionID, ProcesoID: _ProcesoID },
            success: function (data) { 
                if (data.length>0) {
                    $("#lblIndi1").text(data[0] !== undefined ? data[0].Text : "-");
                    $("#lblIndi2").text(data[1] !== undefined ? data[1].Text : "-");
                    $("#lblIndi3").text(data[2] !== undefined ? data[2].Text : "-");
                    $("#lblIndi4").text(data[3] !== undefined ? data[3].Text : "-");
                    $("#lblIndi5").text(data[4] !== undefined ? data[4].Text : "-");
                    $("#lblIndi6").text(data[5] !== undefined ? data[5].Text : "-");
                } else {
                    $("#lblIndi1").text("-");
                    $("#lblIndi2").text("-");
                    $("#lblIndi3").text("-");
                    $("#lblIndi4").text("-");
                    $("#lblIndi5").text("-");
                    $("#lblIndi6").text("-");
                }
            },
            error: function (errorData) { console.log("Request Failed: " + errorData); }
        });
    }
</script>


